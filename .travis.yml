language: node_js
node_js:
  - "lts/*"
cache: yarn

after_success: npx codecov

jobs:
  include:
    - script: yarn test:coverage

    - stage: release
      if: branch = master
      node_js: lts/*
      script: skip
      deploy:
        provider: script
        skip_cleanup: true
        script: "echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" > ~/.npmrc && git remote set-url origin https://${GH_TOKEN}@github.com/${TRAVIS_REPO_SLUG}.git && git checkout master && lerna publish --yes --skip-npm"
